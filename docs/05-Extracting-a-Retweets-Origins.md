# Extracting a Retweet’s Origins

## Problem

You want to extract the originating source from a retweet.

## Solution

If the tweet’s `retweet_count` field is greater than `0`, extract name out of the tweet’s user field; also parse the text of the tweet with a regular expression.

## Discussion

Twitter is _pretty darn good_ about <strike>weaponizing</strike>utilizing the data on its platform. There aren't many cases nowadays when you need to parse `RT` or `via` in hand-crafted retweets, but it's good to have the tools in your aresenal when needed. We can pick out all the retweets from `#rstats` (warning: it's a retweet-heavy hashtag) and who they refer to using the `retweet_count` but also looking for a special [regular expression](https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html) (regex) and extracting data that way.

First, the modern, API-centric way:


```r
library(rtweet)
library(tidyverse)
```

```r
rstats <- search_tweets("#rstats", n=500)

glimpse(rstats)
```

```
## Observations: 500
## Variables: 42
## $ status_id              <chr> "948590403036569601", "9485903595247861...
## $ created_at             <dttm> 2018-01-03 16:22:30, 2018-01-03 16:22:...
## $ user_id                <chr> "280608149", "781583089667420161", "594...
## $ screen_name            <chr> "cortinah", "LynnYarmey", "thibaultdej"...
## $ text                   <chr> "Airline passenger safety has clearly i...
## $ source                 <chr> "TweetDeck", "Twitter for iPhone", "Twi...
## $ reply_to_status_id     <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ reply_to_user_id       <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ reply_to_screen_name   <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ is_quote               <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALS...
## $ is_retweet             <lgl> FALSE, TRUE, FALSE, FALSE, FALSE, TRUE,...
## $ favorite_count         <int> 0, 0, 0, 1, 2, 0, 0, 2, 1, 0, 0, 0, 0, ...
## $ retweet_count          <int> 0, 11, 0, 0, 2, 9, 15, 1, 0, 15, 4, 0, ...
## $ hashtags               <list> [<"rstats", "ggplot2">, "rstats", "rst...
## $ symbols                <list> [NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
## $ urls_url               <list> [NA, NA, "tidyverse.org/articles/2017/...
## $ urls_t.co              <list> [NA, NA, "https://t.co/xFf78u9sIX", "h...
## $ urls_expanded_url      <list> [NA, NA, "https://www.tidyverse.org/ar...
## $ media_url              <list> ["http://pbs.twimg.com/media/DSoOd51Wk...
## $ media_t.co             <list> ["https://t.co/DNifWLdiVY", NA, NA, NA...
## $ media_expanded_url     <list> ["https://twitter.com/cortinah/status/...
## $ media_type             <list> ["photo", NA, NA, NA, NA, NA, "photo",...
## $ ext_media_url          <list> ["http://pbs.twimg.com/media/DSoOd51Wk...
## $ ext_media_t.co         <list> ["https://t.co/DNifWLdiVY", NA, NA, NA...
## $ ext_media_expanded_url <list> ["https://twitter.com/cortinah/status/...
## $ ext_media_type         <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ mentions_user_id       <list> [NA, <"189172089", "862680370436874240...
## $ mentions_screen_name   <list> [NA, <"rgfitzjohn", "vaccineimpact">, ...
## $ lang                   <chr> "en", "en", "fr", "en", "en", "en", "en...
## $ quoted_status_id       <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ quoted_text            <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ retweet_status_id      <chr> NA, "948501344989663233", NA, NA, NA, "...
## $ retweet_text           <chr> NA, "Last week to apply for our #rstats...
## $ place_url              <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ place_name             <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ place_full_name        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ place_type             <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ country                <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ country_code           <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ geo_coords             <list> [<NA, NA>, <NA, NA>, <NA, NA>, <NA, NA...
## $ coords_coords          <list> [<NA, NA>, <NA, NA>, <NA, NA>, <NA, NA...
## $ bbox_coords            <list> [<NA, NA, NA, NA, NA, NA, NA, NA>, <NA...
```

```r
filter(rstats, retweet_count > 0) %>% 
  select(text, mentions_screen_name, retweet_count) %>% 
  mutate(text = substr(text, 1, 30)) %>% 
  unnest()
```

```
## # A tibble: 567 x 3
##                                         text retweet_count
##                                        <chr>         <int>
##  1            RT @rgfitzjohn: Last week to a            11
##  2            RT @rgfitzjohn: Last week to a            11
##  3            I couldn't resist and I just s             2
##  4 "RT @apreshill: \U0001f929 Snake case is"             9
##  5            RT @JeroenBoeye: New post on d            15
##  6            What is the most efficient way             1
##  7            RT @JeroenBoeye: New post on d            15
##  8            RT @GioraSimchoni: My very fir             4
##  9            RT @GioraSimchoni: My very fir             4
## 10            RT @GioraSimchoni: My very fir             4
## # ... with 557 more rows, and 1 more variables: mentions_screen_name <chr>
```

The `text` column was pared down for display brevity. If you run that code snippet you can examine it to see that it identifies the retweets and the first screen name is usually the main reference, but you get all of the screen names from the original tweet for free.

Here's the brute-force way. A regular expression is used that matches the vast majority of retweet formats. The patten looks for them then extracts the first found screen name:


```r
# regex mod from https://stackoverflow.com/questions/655903/python-regular-expression-for-retweets
filter(rstats, str_detect(text, "(RT|via)((?:[[:blank:]:]\\W*@\\w+)+)")) %>% 
  select(text, mentions_screen_name, retweet_count) %>% 
  mutate(extracted = str_match(text, "(RT|via)((?:[[:blank:]:]\\W*@\\w+)+)")[,3]) %>% 
  mutate(text = substr(text, 1, 30)) %>% 
  unnest()
```

```
## # A tibble: 485 x 4
##                                         text retweet_count
##                                        <chr>         <int>
##  1            RT @rgfitzjohn: Last week to a            11
##  2            RT @rgfitzjohn: Last week to a            11
##  3 "RT @apreshill: \U0001f929 Snake case is"             9
##  4            RT @JeroenBoeye: New post on d            15
##  5            RT @JeroenBoeye: New post on d            15
##  6            RT @GioraSimchoni: My very fir             4
##  7            RT @GioraSimchoni: My very fir             4
##  8            RT @GioraSimchoni: My very fir             4
##  9            RT @krlmlr: Soon on CRAN: Join            14
## 10            RT @krlmlr: Soon on CRAN: Join            14
## # ... with 475 more rows, and 2 more variables: extracted <chr>,
## #   mentions_screen_name <chr>
```

You should try the above snippets for other tags as there will be cases when the regex will pick up retweets Twitter has failed to capture.

## See Also

- Twiter [official documentation](https://developer.twitter.com/en/docs/tweets/post-and-engage/guides/tweet-availability) on what happens to retweets when origin tweets are deleted
